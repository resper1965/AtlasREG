â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                              â•‘
â•‘         CLOUDFLARE TUNNEL - SOLUÃ‡ÃƒO FRONTEND NA CLOUDFLARE                   â•‘
â•‘                                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Data: 20 de Outubro de 2025
Email: resper@ness.com.br
Powered by: ness.

================================================================================
âœ… SOLUÃ‡ÃƒO: CLOUDFLARE TUNNEL
================================================================================

O QUE Ã‰:
--------
Cloudflare Tunnel cria um tÃºnel seguro entre seu servidor local (Docker) 
e a Cloudflare Edge, permitindo que aplicaÃ§Ãµes locais sejam acessadas via
domÃ­nio Cloudflare com HTTPS, CDN e DDoS protection.

COMO FUNCIONA:
--------------

   Seu Docker               Cloudflare Tunnel           Cloudflare Edge
   (localhost:3100)  â†â”€â”€â”€â†’  (tÃºnel seguro)  â†â”€â”€â”€â†’      (atlasREG.ness.tec.br)
         â†“                                                       â†“
   Next.js SSR                                             UsuÃ¡rios globais
   (executa cÃ³digo)                                        (recebem HTML)

VANTAGENS:
----------
âœ… SSR Next.js funciona 100%
âœ… Frontend na Cloudflare Edge (seu requisito!)
âœ… HTTPS automÃ¡tico
âœ… DDoS protection Cloudflare
âœ… CDN global
âœ… Zero modificaÃ§Ãµes de cÃ³digo
âœ… Setup em 10 minutos
âœ… $0/mÃªs (FREE)

================================================================================
SETUP AUTOMÃTICO
================================================================================

OPÃ‡ÃƒO 1: Script AutomÃ¡tico (Recomendado)
-----------------------------------------

./cloudflare/TUNNEL_SETUP.sh

O script vai:
1. âœ“ Verificar frontend rodando
2. âœ“ Instalar cloudflared (se necessÃ¡rio)
3. âœ“ Autenticar Cloudflare
4. âœ“ Criar tunnel
5. âœ“ Configurar automaticamente
6. âœ“ Criar DNS automaticamente
7. âœ“ Iniciar tunnel

Tempo: 10 minutos (incluindo autenticaÃ§Ã£o)

OPÃ‡ÃƒO 2: Manual (Passo a Passo)
--------------------------------

Veja seÃ§Ã£o "SETUP MANUAL" abaixo.

================================================================================
SETUP MANUAL (Detalhado)
================================================================================

PASSO 1: Instalar cloudflared
------------------------------

# Download
wget https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb

# Instalar
sudo dpkg -i cloudflared-linux-amd64.deb

# Verificar
cloudflared --version

PASSO 2: Autenticar
-------------------

cloudflared tunnel login

# Abre navegador
# Login na Cloudflare
# Autorizar acesso
# Cert salvo em ~/.cloudflared/cert.pem

PASSO 3: Criar Tunnel
---------------------

cloudflared tunnel create atlasreg-frontend

# Retorna:
# Tunnel ID: abc123...
# Credentials: ~/.cloudflared/TUNNEL_ID.json

PASSO 4: Configurar Tunnel
---------------------------

# Criar arquivo config
nano ~/.cloudflared/config.yml

# ConteÃºdo:
tunnel: TUNNEL_ID_AQUI
credentials-file: /home/resper/.cloudflared/TUNNEL_ID.json

ingress:
  - hostname: atlasREG.ness.tec.br
    service: http://localhost:3100
  - hostname: web.atlasREG.ness.tec.br
    service: http://localhost:3100
  - service: http_status:404

PASSO 5: Criar DNS
------------------

cloudflared tunnel route dns TUNNEL_ID atlasREG.ness.tec.br
cloudflared tunnel route dns TUNNEL_ID web.atlasREG.ness.tec.br

# DNS criado automaticamente na Cloudflare

PASSO 6: Rodar Tunnel
---------------------

# Modo foreground (teste)
cloudflared tunnel run atlasreg-frontend

# Modo background
cloudflared tunnel run atlasreg-frontend &

# Ou como serviÃ§o (permanente)
sudo cloudflared service install
sudo systemctl start cloudflared
sudo systemctl enable cloudflared

PRONTO! Frontend acessÃ­vel em:
https://atlasREG.ness.tec.br

================================================================================
CONFIGURAÃ‡ÃƒO ADICIONAL
================================================================================

MÃšLTIPLOS SERVIÃ‡OS (Opcional):
-------------------------------

Se quiser expor API tambÃ©m:

ingress:
  - hostname: atlasREG.ness.tec.br
    service: http://localhost:3100
  - hostname: api.atlasREG.ness.tec.br
    service: http://localhost:8200
  - hostname: airflow.atlasREG.ness.tec.br
    service: http://localhost:8300
  - service: http_status:404

LOAD BALANCING (Opcional):
---------------------------

Para mÃºltiplas instÃ¢ncias:

ingress:
  - hostname: atlasREG.ness.tec.br
    service: http://localhost:3100
    originRequest:
      connectTimeout: 30s
      noTLSVerify: false
  - service: http_status:404

================================================================================
GERENCIAMENTO DO TUNNEL
================================================================================

COMANDOS ÃšTEIS:
---------------

# Listar tunnels
cloudflared tunnel list

# Info do tunnel
cloudflared tunnel info atlasreg-frontend

# Cleanup (deletar tunnel)
cloudflared tunnel delete atlasreg-frontend

# Logs
cloudflared tunnel run atlasreg-frontend --loglevel debug

# Status
cloudflared tunnel info atlasreg-frontend

# Parar serviÃ§o
sudo systemctl stop cloudflared

# Ver logs serviÃ§o
sudo journalctl -u cloudflared -f

================================================================================
RODAR COMO SERVIÃ‡O (Permanente)
================================================================================

Para tunnel rodar automaticamente apÃ³s reboot:

1. Instalar como serviÃ§o:
   sudo cloudflared service install

2. Iniciar:
   sudo systemctl start cloudflared

3. Habilitar auto-start:
   sudo systemctl enable cloudflared

4. Status:
   sudo systemctl status cloudflared

5. Logs:
   sudo journalctl -u cloudflared -f

6. Parar:
   sudo systemctl stop cloudflared

CONFIGURAÃ‡ÃƒO:
O serviÃ§o usa: ~/.cloudflared/config.yml

================================================================================
TROUBLESHOOTING
================================================================================

ERRO: "Unable to reach the origin service"
SOLUÃ‡ÃƒO: Verificar se frontend estÃ¡ rodando
         docker ps | grep atlasreg-web
         curl http://localhost:3100

ERRO: "Failed to create tunnel"
SOLUÃ‡ÃƒO: Verificar autenticaÃ§Ã£o
         cloudflared tunnel login

ERRO: "DNS record already exists"
SOLUÃ‡ÃƒO: DNS jÃ¡ foi criado (ok!)
         Verificar: https://dash.cloudflare.com/ â†’ DNS

ERRO: "Tunnel not found"
SOLUÃ‡ÃƒO: Criar tunnel primeiro
         cloudflared tunnel create atlasreg-frontend

ERRO: 502 Bad Gateway
SOLUÃ‡ÃƒO: Frontend pode estar reiniciando
         Aguardar 10-20 segundos
         docker logs -f atlasreg-web

================================================================================
MONITORAMENTO
================================================================================

VER MÃ‰TRICAS:
-------------
Cloudflare Dashboard â†’ Zero Trust â†’ Access â†’ Tunnels
â†’ Selecionar tunnel atlasreg-frontend
â†’ Ver mÃ©tricas de trÃ¡fego

VER LOGS:
---------
# Tunnel
cloudflared tunnel run atlasreg-frontend --loglevel debug

# Frontend
docker logs -f atlasreg-web

# Sistema
sudo journalctl -u cloudflared -f

HEALTH CHECK:
-------------
curl -I https://atlasREG.ness.tec.br
curl https://atlasREG.ness.tec.br/dashboard/default

================================================================================
SEGURANÃ‡A
================================================================================

RECURSOS DE SEGURANÃ‡A:
----------------------
âœ“ HTTPS automÃ¡tico (TLS 1.3)
âœ“ Certificado SSL gerenciado pela Cloudflare
âœ“ DDoS protection
âœ“ WAF (Web Application Firewall)
âœ“ Tunnel criptografado
âœ“ Sem portas abertas no firewall

CLOUDFLARE ACCESS (Opcional):
------------------------------
Adicionar autenticaÃ§Ã£o na frente do tunnel:

Dashboard â†’ Zero Trust â†’ Access â†’ Applications
â†’ Add an application
â†’ Self-hosted
â†’ Domain: atlasREG.ness.tec.br
â†’ Adicionar regras de acesso

================================================================================
CUSTOS
================================================================================

Cloudflare Tunnel: $0/mÃªs (FREE)

IncluÃ­do:
- Unlimited bandwidth
- Unlimited requests
- HTTPS/SSL automÃ¡tico
- DDoS protection
- CDN global
- Analytics bÃ¡sico

Pago (opcional):
- Cloudflare Access (autenticaÃ§Ã£o): $0-7/usuÃ¡rio/mÃªs
- Argo Smart Routing: $0.10/GB
- Load Balancing: $5/mÃªs

RecomendaÃ§Ã£o: FREE tier Ã© suficiente!

================================================================================
COMPARAÃ‡ÃƒO: TUNNEL vs PAGES
================================================================================

                          Tunnel         Pages
                          (SoluÃ§Ã£o)      (Problema)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Next.js SSR               âœ… Funciona    âŒ NÃ£o funciona
Modificar cÃ³digo          âŒ NÃ£o precisa âœ… Precisa adapter
Setup                     10 minutos     Aguardar OpenNext
Cloudflare Edge           âœ…             âœ…
HTTPS automÃ¡tico          âœ…             âœ…
DDoS protection           âœ…             âœ…
Custo                     $0/mÃªs         $0/mÃªs
ManutenÃ§Ã£o                FÃ¡cil          N/A
Features Next.js          100%           0%

VENCEDOR: Tunnel ğŸ†

================================================================================
APÃ“S CONFIGURAR
================================================================================

URLS DISPONÃVEIS:
-----------------
Frontend:  https://atlasREG.ness.tec.br â† NOVO!
           https://web.atlasREG.ness.tec.br â† NOVO!
           http://localhost:3100 â† Mantido

Workers:   https://atlasreg-api-gateway.ness.workers.dev
           https://atlasreg-trigger-ingest.ness.workers.dev
           https://atlasreg-webhook-receiver.ness.workers.dev

GitHub:    https://github.com/resper1965/AtlasREG

ARQUITETURA FINAL:
------------------

                    Cloudflare Edge
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Tunnel (Frontend)   â”‚ â† atlasREG.ness.tec.br
                    â”‚ Workers (API)       â”‚
                    â”‚ Queue, KV, R2       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ VPS/Local (Docker)  â”‚
                    â”‚ Frontend :3100      â”‚
                    â”‚ API :8200           â”‚
                    â”‚ Orchestrator        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

RESULTADO:
----------
âœ… Frontend Next.js SSR na Cloudflare Edge
âœ… HTTPS automÃ¡tico
âœ… DomÃ­nio customizado
âœ… Performance global
âœ… $0/mÃªs

================================================================================
COMANDOS RÃPIDOS
================================================================================

# Setup completo
./cloudflare/TUNNEL_SETUP.sh

# Rodar tunnel
cloudflared tunnel run atlasreg-frontend

# Background
cloudflared tunnel run atlasreg-frontend &

# ServiÃ§o permanente
sudo cloudflared service install
sudo systemctl start cloudflared

# Status
cloudflared tunnel list
cloudflared tunnel info atlasreg-frontend

# Testar
curl https://atlasREG.ness.tec.br

================================================================================
PRÃ“XIMOS PASSOS
================================================================================

1. â˜ Executar: ./cloudflare/TUNNEL_SETUP.sh
2. â˜ Aguardar DNS propagar (2-5 min)
3. â˜ Testar: https://atlasREG.ness.tec.br
4. â˜ Configurar tunnel como serviÃ§o (permanente)
5. â˜ Atualizar documentaÃ§Ã£o

TEMPO TOTAL: 10-15 minutos

RESULTADO:
==========
Frontend AtlasReg funcionando na Cloudflare Edge com:
- SSR completo
- HTTPS
- DomÃ­nio customizado
- DDoS protection
- $0/mÃªs

================================================================================
Powered by: ness.
Email: resper@ness.com.br
Status: âœ“ SoluÃ§Ã£o pronta para implementaÃ§Ã£o
================================================================================

