================================================================================
                    ATLASREG - COMO COMEÃ‡AR A USAR
                         Guia RÃ¡pido e PrÃ¡tico
================================================================================

Data: 20 de Outubro de 2025
Powered by: ness.

================================================================================
STATUS: SISTEMA OPERACIONAL âœ“
================================================================================

âœ“ 11 containers rodando
âœ“ Orchestrator pronto para receber mensagens
âœ“ AtlasReg Core disponÃ­vel
âœ“ Frontend acessÃ­vel em http://localhost:3100

================================================================================
1. TESTE RÃPIDO: ENVIAR MENSAGEM PARA O ORCHESTRATOR
================================================================================

O orchestrator aguarda mensagens na fila Redis. Vamos enviar uma mensagem
de teste para ver ele processando:

PASSO 1: Enviar mensagem de teste
----------------------------------
$ docker exec atlasreg-redis redis-cli -n 2 RPUSH orchestrator:queue:ingest-queue \
  '{"type":"start_daily_ingest","date":"2025-10-20","run_id":"test-001"}'

PASSO 2: Ver orchestrator processando
--------------------------------------
$ docker logs -f atlasreg-orchestrator

VocÃª verÃ¡ logs JSON como:
{"event": "message_received", "type": "start_daily_ingest"}
{"event": "processing_daily_ingest", "date": "2025-10-20"}
{"event": "fetching_sources_catalog"}
...

PASSO 3: Verificar fila
-----------------------
$ docker exec atlasreg-redis redis-cli -n 2 LLEN orchestrator:queue:ingest-queue

Resultado: 0 (fila vazia, mensagem foi processada)

================================================================================
2. ACESSAR INTERFACES WEB
================================================================================

FRONTEND ATLASREG:
------------------
URL: http://localhost:3100
DescriÃ§Ã£o: Interface principal do AtlasReg
Funcionalidades: Dashboard, visualizaÃ§Ãµes, relatÃ³rios

AIRFLOW:
--------
URL: http://localhost:8300
Login: admin / admin
DescriÃ§Ã£o: OrquestraÃ§Ã£o de workflows
Funcionalidades: DAGs, tarefas, scheduling

CELERY FLOWER:
--------------
URL: http://localhost:5600
DescriÃ§Ã£o: Monitor de workers Celery
Funcionalidades: Ver tasks, workers, filas

MINIO (S3):
-----------
URL: http://localhost:9201
Login: admin / atlasreg2025
DescriÃ§Ã£o: Object storage (S3-compatible)
Funcionalidades: Buckets, upload/download

ELASTICSEARCH:
--------------
URL: http://localhost:9300
DescriÃ§Ã£o: Search engine
Funcionalidades: Ãndices, queries

================================================================================
3. TESTAR PIPELINE COMPLETO
================================================================================

CENÃRIO: Coletar notÃ­cias de uma fonte especÃ­fica

PASSO 1: Criar configuraÃ§Ã£o de fonte
-------------------------------------
$ cat > /tmp/test_source.json << 'EOF'
{
  "source_id": "test-source-001",
  "nome": "Portal Teste",
  "url_feed": "https://example.com/rss",
  "handler_id": "SCRAPY_RSS_GENERIC",
  "ativo": true,
  "player_id": null
}
EOF

PASSO 2: Enviar mensagem com fonte especÃ­fica
---------------------------------------------
$ docker exec atlasreg-redis redis-cli -n 2 RPUSH orchestrator:queue:ingest-queue \
  '{"type":"start_daily_ingest","date":"2025-10-20","sources":[{"source_id":"test-001","url":"https://example.com/rss","handler":"SCRAPY_RSS_GENERIC"}]}'

PASSO 3: Acompanhar processamento
----------------------------------
$ docker logs -f atlasreg-orchestrator

PASSO 4: Verificar resultado
-----------------------------
Logs mostrarÃ£o:
- Fonte identificada
- Scraper acionado
- Dados coletados
- Processamento IA
- IndexaÃ§Ã£o
- PublicaÃ§Ã£o

================================================================================
4. MODO DESENVOLVIMENTO: TESTE LOCAL
================================================================================

Para testar sem Cloudflare (modo standalone - jÃ¡ ativo):

CONFIGURAÃ‡ÃƒO ATUAL (.env):
--------------------------
MODE=standalone
REDIS_URL=redis://redis:6379/2
LOG_LEVEL=INFO

COMO FUNCIONA:
--------------
1. Orchestrator lÃª da fila Redis (db 2)
2. Processa localmente
3. Salva no MinIO local
4. Indexa no Elasticsearch local

PARA ADICIONAR MENSAGENS:
--------------------------
# Ingest diÃ¡rio completo
docker exec atlasreg-redis redis-cli -n 2 RPUSH orchestrator:queue:ingest-queue \
  '{"type":"start_daily_ingest","date":"2025-10-20"}'

# Reprocessar data especÃ­fica
docker exec atlasreg-redis redis-cli -n 2 RPUSH orchestrator:queue:ingest-queue \
  '{"type":"reprocess","date":"2025-10-15"}'

================================================================================
5. COMANDOS ESSENCIAIS
================================================================================

VER STATUS:
-----------
$ docker ps | grep atlasreg

RESTART ORCHESTRATOR:
--------------------
$ docker-compose restart orchestrator

VER LOGS EM TEMPO REAL:
-----------------------
$ docker logs -f atlasreg-orchestrator

VERIFICAR SAÃšDE:
---------------
$ docker inspect atlasreg-orchestrator | grep -A 5 Health

PARAR TUDO:
-----------
$ docker-compose stop

INICIAR TUDO:
-------------
$ docker-compose up -d

REBUILD ORCHESTRATOR:
--------------------
$ docker-compose build orchestrator --no-cache
$ docker-compose up -d orchestrator

================================================================================
6. ESTRUTURA DE MENSAGENS
================================================================================

TIPO 1: start_daily_ingest
---------------------------
DescriÃ§Ã£o: Inicia coleta diÃ¡ria de todas as fontes ativas
Formato:
{
  "type": "start_daily_ingest",
  "date": "YYYY-MM-DD",
  "run_id": "opcional-id-unico"
}

Exemplo:
{
  "type": "start_daily_ingest",
  "date": "2025-10-20",
  "run_id": "daily-20251020-001"
}

TIPO 2: reprocess
-----------------
DescriÃ§Ã£o: Reprocessa dados de uma data especÃ­fica
Formato:
{
  "type": "reprocess",
  "date": "YYYY-MM-DD",
  "force": true
}

Exemplo:
{
  "type": "reprocess",
  "date": "2025-10-15",
  "force": true
}

TIPO 3: custom (futuro)
-----------------------
Para tasks customizadas:
{
  "type": "custom",
  "task": "nome_da_task",
  "params": {...}
}

================================================================================
7. MONITORAMENTO E DEBUG
================================================================================

VER LOGS ESTRUTURADOS:
---------------------
$ docker logs atlasreg-orchestrator | jq '.'

FILTRAR APENAS ERROS:
--------------------
$ docker logs atlasreg-orchestrator | jq 'select(.level=="error")'

VER EVENTOS ESPECÃFICOS:
------------------------
$ docker logs atlasreg-orchestrator | jq 'select(.event=="message_received")'

VERIFICAR FILA REDIS:
--------------------
# Ver tamanho da fila
$ docker exec atlasreg-redis redis-cli -n 2 LLEN orchestrator:queue:ingest-queue

# Ver prÃ³xima mensagem (sem remover)
$ docker exec atlasreg-redis redis-cli -n 2 LINDEX orchestrator:queue:ingest-queue 0

# Limpar fila
$ docker exec atlasreg-redis redis-cli -n 2 DEL orchestrator:queue:ingest-queue

VERIFICAR MEMÃ“RIA/CPU:
---------------------
$ docker stats atlasreg-orchestrator --no-stream

================================================================================
8. PRÃ“XIMOS PASSOS
================================================================================

CURTO PRAZO (Desenvolvimento):
-------------------------------
â˜ Implementar tasks Celery para scrapers
â˜ Habilitar Airflow API (auth + endpoints)
â˜ Criar DAGs dinÃ¢micos por fonte
â˜ Testar com scrapers reais (CVM, G1, etc)
â˜ Implementar pipeline IA completo
â˜ Gerar JSON Gold

MÃ‰DIO PRAZO (IntegraÃ§Ã£o):
--------------------------
â˜ Criar conta Cloudflare
â˜ Provisionar Queue, KV, R2
â˜ Criar Workers (trigger + receiver)
â˜ Configurar webhooks HMAC
â˜ Deploy em VPS de produÃ§Ã£o
â˜ Trocar MODE=cloudflare

LONGO PRAZO (ProduÃ§Ã£o):
-----------------------
â˜ Monitoramento avanÃ§ado (Grafana)
â˜ Alertas automÃ¡ticos
â˜ Backup automÃ¡tico
â˜ Scaling horizontal
â˜ CI/CD pipeline

================================================================================
9. TROUBLESHOOTING
================================================================================

PROBLEMA: Orchestrator nÃ£o processa mensagens
SOLUÃ‡ÃƒO:
1. Verificar se estÃ¡ rodando: docker ps | grep orchestrator
2. Ver logs: docker logs atlasreg-orchestrator
3. Verificar fila: docker exec atlasreg-redis redis-cli -n 2 LLEN orchestrator:queue:ingest-queue
4. Restart: docker-compose restart orchestrator

PROBLEMA: Redis connection error
SOLUÃ‡ÃƒO:
1. Verificar Redis: docker ps | grep redis
2. Testar conexÃ£o: docker exec atlasreg-redis redis-cli ping
3. Verificar porta: netstat -tulpn | grep 6382
4. Restart Redis: docker-compose restart redis

PROBLEMA: NÃ£o encontra scrapers
SOLUÃ‡ÃƒO:
1. Verificar volume: docker inspect atlasreg-orchestrator | grep Mounts
2. Verificar path: docker exec atlasreg-orchestrator ls -la /app/scrapers
3. Rebuild: docker-compose build orchestrator

PROBLEMA: Airflow API nÃ£o responde
SOLUÃ‡ÃƒO:
1. Verificar Airflow: docker ps | grep airflow-webserver
2. Acessar UI: http://localhost:8300
3. Habilitar API no airflow.cfg
4. Restart: docker-compose restart airflow-webserver

================================================================================
10. EXEMPLO COMPLETO: TESTE END-TO-END
================================================================================

OBJETIVO: Enviar mensagem, processar e verificar resultado

# 1. Verificar sistema
docker ps | grep atlasreg

# 2. Limpar fila (comeÃ§ar do zero)
docker exec atlasreg-redis redis-cli -n 2 DEL orchestrator:queue:ingest-queue

# 3. Enviar mensagem de teste
docker exec atlasreg-redis redis-cli -n 2 RPUSH orchestrator:queue:ingest-queue \
  '{"type":"start_daily_ingest","date":"2025-10-20","run_id":"test-e2e-001"}'

# 4. Confirmar mensagem na fila
docker exec atlasreg-redis redis-cli -n 2 LLEN orchestrator:queue:ingest-queue
# Deve retornar: 1

# 5. Acompanhar processamento
docker logs -f atlasreg-orchestrator

# 6. Aguardar ~30 segundos (poll interval)

# 7. Verificar fila novamente (deve estar vazia)
docker exec atlasreg-redis redis-cli -n 2 LLEN orchestrator:queue:ingest-queue
# Deve retornar: 0

# 8. Ver logs completos
docker logs atlasreg-orchestrator | jq 'select(.run_id=="test-e2e-001")'

PRONTO! Mensagem processada com sucesso.

================================================================================
RESUMO: ESTÃ TUDO PRONTO PARA COMEÃ‡AR!
================================================================================

âœ“ Sistema operacional (11 containers)
âœ“ Orchestrator aguardando mensagens
âœ“ Interfaces web disponÃ­veis
âœ“ Comandos de teste prontos

COMECE AGORA:
-------------

1. Teste rÃ¡pido (1 min):
   docker logs -f atlasreg-orchestrator

2. Enviar mensagem (1 min):
   docker exec atlasreg-redis redis-cli -n 2 RPUSH orchestrator:queue:ingest-queue \
     '{"type":"start_daily_ingest","date":"2025-10-20"}'

3. Acessar frontend (navegador):
   http://localhost:3100

BOA SORTE! ðŸš€

================================================================================
Powered by: ness.
================================================================================

